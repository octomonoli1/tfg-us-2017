{"version":3,"sources":["/source/CropHandles.es.js"],"names":[],"mappings":"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","sourcesContent":["import Component from 'metal-component/src/Component';\nimport Soy from 'metal-soy/src/Soy';\n\nimport async from 'metal/src/async/async';\nimport core from 'metal/src/core';\nimport dom from 'metal-dom/src/dom';\nimport Drag from 'metal-drag-drop/src/Drag';\nimport Position from 'metal-position/src/Position';\n\nimport handlesTemplates from './CropHandles.soy';\n\n/**\n * Crop Handles\n */\nclass CropHandles extends Component {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tthis.parentNode_ = this.element.parentNode;\n\n\t\tthis.resizer = this.element.querySelector('.resize-handle');\n\n\t\tthis.selectionBorderWidth_ = parseInt(this.element.style.borderWidth, 10);\n\n\t\tthis.croppedPreview_ = this.element.querySelector('.cropped-image-preview');\n\n\t\tthis.croppedPreviewContext_ = this.croppedPreview_.getContext('2d');\n\n\t\tasync.nextTick(() => {\n\t\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\t\tthis.setSelectionInitialStyle_();\n\n\t\t\tthis.initializeDrags_();\n\n\t\t\tdom.removeClasses(this.element, 'hide');\n\t\t\tdom.append(canvas.parentElement, this.element);\n\t\t});\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdetached() {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tcanvas.style.opacity = 1;\n\t}\n\n\t/**\n\t * Bind actions for the mover and the size handler.\n\t *\n\t * @protected\n\t */\n\tbindDrags_() {\n\t\tthis.resizer.addEventListener('mousedown', (event) => event.stopPropagation());\n\n\t\tthis.bindSelectionDrag_();\n\t\tthis.bindSizeDrag_();\n\t}\n\n\t/**\n\t * Bind actions for the mover.\n\t *\n\t * @protected\n\t */\n\tbindSelectionDrag_() {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tthis.selectionDrag_.on(Drag.Events.DRAG, (data, event) => {\n\t\t\tlet left = data.relativeX - canvas.offsetLeft + this.selectionBorderWidth_;\n\t\t\tlet top = data.relativeY - canvas.offsetTop + this.selectionBorderWidth_;\n\n\t\t\tthis.element.style.left = left + 'px';\n\t\t\tthis.element.style.top = top + 'px';\n\n\t\t\tthis.croppedPreviewContext_.drawImage(\n\t\t\t\tcanvas,\n\t\t\t\tleft,\n\t\t\t\ttop,\n\t\t\t\tthis.croppedPreview_.width,\n\t\t\t\tthis.croppedPreview_.height,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.croppedPreview_.width,\n\t\t\t\tthis.croppedPreview_.height\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * Bind actions for the size handler.\n\t *\n\t * @protected\n\t */\n\tbindSizeDrag_() {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tthis.sizeDrag_.on(Drag.Events.DRAG, (data, event) => {\n\t\t\tlet width = data.relativeX + this.resizer.offsetWidth / 2;\n\t\t\tlet height = data.relativeY + this.resizer.offsetHeight / 2;\n\n\t\t\tthis.element.style.width = width + this.selectionBorderWidth_ * 2 + 'px';\n\t\t\tthis.element.style.height = height + this.selectionBorderWidth_ * 2 + 'px';\n\n\t\t\tthis.croppedPreview_.width = width;\n\t\t\tthis.croppedPreview_.height = height;\n\n\t\t\tthis.croppedPreviewContext_.drawImage(\n\t\t\t\tcanvas,\n\t\t\t\tthis.element.offsetLeft - canvas.offsetLeft + this.selectionBorderWidth_,\n\t\t\t\tthis.element.offsetTop - canvas.offsetTop + this.selectionBorderWidth_,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t);\n\t\t\tthis.croppedPreview_.style.width = width + 'px';\n\t\t\tthis.croppedPreview_.style.height = height + 'px';\n\t\t});\n\t}\n\n\t/**\n\t * Calculates the constrain region for the selection drag and resize.\n\t *\n\t * @protected\n\t */\n\tgetSizeDragConstrain_(region) {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tlet constrain = Position.getRegion(canvas);\n\n\t\tlet selection = Position.getRegion(this.element);\n\n\t\tconstrain.left = selection.left + this.resizer.offsetWidth + this.selectionBorderWidth_ * 2;\n\t\tconstrain.top = selection.top + this.resizer.offsetHeight + this.selectionBorderWidth_ * 2;\n\t\tconstrain.width = constrain.right - constrain.left;\n\t\tconstrain.height = constrain.bottom - constrain.top;\n\t\tconstrain.right += this.resizer.offsetWidth / 2 - this.selectionBorderWidth_;\n\t\tconstrain.bottom += this.resizer.offsetHeight / 2 - this.selectionBorderWidth_;\n\n\t\tif (region.left < constrain.left) {\n\t\t\tregion.left = constrain.left;\n\t\t}\n\t\telse if (region.right > constrain.right) {\n\t\t\tregion.left -= region.right - constrain.right;\n\t\t}\n\n\t\tif (region.top < constrain.top) {\n\t\t\tregion.top = constrain.top;\n\t\t}\n\t\telse if (region.bottom > constrain.bottom) {\n\t\t\tregion.top -= region.bottom - constrain.bottom;\n\t\t}\n\n\t\tregion.right = region.left + region.width;\n\t\tregion.bottom = region.top + region.height;\n\t}\n\n\t/**\n\t * Initializes the mover and the size handler.\n\t *\n\t * @protected\n\t */\n\tinitializeDrags_() {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tthis.selectionDrag_ = new Drag(\n\t\t\t{\n\t\t\t\tconstrain: canvas,\n\t\t\t\thandles: this.element,\n\t\t\t\tsources: this.element\n\t\t\t}\n\t\t);\n\n\t\tthis.sizeDrag_ = new Drag(\n\t\t\t{\n\t\t\t\tconstrain: this.getSizeDragConstrain_.bind(this),\n\t\t\t\thandles: this.resizer,\n\t\t\t\tsources: this.resizer\n\t\t\t}\n\t\t);\n\n\t\tthis.bindDrags_();\n\t}\n\n\t/**\n\t * Sets the initial style for the selection and preview.\n\t *\n\t * @protected\n\t */\n\tsetSelectionInitialStyle_() {\n\t\tlet canvas = this.getImageEditorCanvas();\n\n\t\tcanvas.style.opacity = 0.5;\n\n\t\tthis.element.style.width = canvas.offsetWidth + 'px';\n\t\tthis.element.style.height = canvas.offsetHeight + 'px';\n\t\tthis.element.style.left = canvas.offsetLeft + 'px';\n\t\tthis.element.style.top = canvas.offsetTop + 'px';\n\n\t\tthis.croppedPreview_.width = canvas.offsetWidth;\n\t\tthis.croppedPreview_.height = canvas.offsetHeight;\n\n\t\tthis.croppedPreviewContext_.drawImage(\n\t\t\tcanvas,\n\t\t\tthis.selectionBorderWidth_,\n\t\t\tthis.selectionBorderWidth_,\n\t\t\tcanvas.width - this.selectionBorderWidth_ * 2,\n\t\t\tcanvas.height - this.selectionBorderWidth_ * 2,\n\t\t\t0,\n\t\t\t0,\n\t\t\tcanvas.width - this.selectionBorderWidth_ * 2,\n\t\t\tcanvas.height - this.selectionBorderWidth_ * 2\n\t\t);\n\n\t\tthis.croppedPreview_.style.width = this.croppedPreview_.width + 'px';\n\t\tthis.croppedPreview_.style.height = this.croppedPreview_.height + 'px';\n\t}\n}\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nCropHandles.STATE = {\n\t/**\n\t * Injected helper to get the editor canvas element\n\t * @type {Function}\n\t */\n\tgetImageEditorCanvas: {\n\t\tvalidator: core.isFunction\n\t}\n};\n\n// Register component\nSoy.register(CropHandles, handlesTemplates);\n\nexport default CropHandles;"]}