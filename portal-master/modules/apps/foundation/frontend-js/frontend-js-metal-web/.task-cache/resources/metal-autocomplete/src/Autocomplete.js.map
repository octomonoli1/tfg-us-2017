{"version":3,"sources":["/source/Autocomplete.js"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport core from 'metal';\nimport debounce from 'metal-debounce';\nimport dom from 'metal-dom';\nimport { CancellablePromise as Promise } from 'metal-promise';\nimport { Align } from 'metal-position';\nimport AutocompleteBase from './AutocompleteBase';\nimport Soy from 'metal-soy';\n\nimport 'metal-list';\nimport templates from './Autocomplete.soy';\n\n/*\n * Autocomplete component.\n */\nclass Autocomplete extends AutocompleteBase {\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tsuper.attached();\n\t\tthis.on('click', event => event.stopPropagation());\n\t\tthis.eventHandler_.add(dom.on(this.inputElement, 'focus', this.handleInputFocus_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(document, 'click', this.handleDocClick_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(window, 'resize', debounce(this.handleWindowResize_.bind(this), 100)));\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Aligns main element to the input element.\n\t */\n\talign() {\n\t\tthis.element.style.width = this.inputElement.offsetWidth + 'px';\n\t\tvar position = Align.align(this.element, this.inputElement, Align.Bottom);\n\n\t\tdom.removeClasses(this.element, this.positionCss_);\n\t\tswitch (position) {\n\t\t\tcase Align.Top:\n\t\t\tcase Align.TopLeft:\n\t\t\tcase Align.TopRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-top';\n\t\t\t\tbreak;\n\t\t\tcase Align.Bottom:\n\t\t\tcase Align.BottomLeft:\n\t\t\tcase Align.BottomRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-bottom';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.positionCss_ = null;\n\n\t\t}\n\t\tdom.addClasses(this.element, this.positionCss_);\n\t}\n\n\t/**\n\t * Returns the `List` component being used to render the matched items.\n\t * @return {!List}\n\t */\n\tgetList() {\n\t\treturn this.components.list;\n\t}\n\n\t/**\n\t * Handles document click in order to hide autocomplete. If input element is\n\t * focused autocomplete will not hide.\n\t * @param {!Event} event\n\t */\n\thandleDocClick_() {\n\t\tif (document.activeElement === this.inputElement) {\n\t\t\treturn;\n\t\t}\n\t\tthis.visible = false;\n\t}\n\n\t/**\n\t * Handles input focus.\n\t * @param {!Event} event\n\t */\n\thandleInputFocus_() {\n\t\tthis.request(this.inputElement.value);\n\t}\n\n\t/**\n\t * Handles window resize events. Realigns the autocomplete results list to\n\t * the input field.\n\t */\n\thandleWindowResize_() {\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trequest(query) {\n\t\tvar self = this;\n\t\treturn super.request(query).then(function(data) {\n\t\t\tif (data) {\n\t\t\t\tdata.forEach(self.assertItemObjectStructure_);\n\t\t\t\tself.getList().items = data;\n\t\t\t}\n\t\t\tself.visible = !!(data && data.length > 0);\n\t\t});\n\t}\n\n\t/**\n\t * Emits a `select` event with the information about the selected item and\n\t * hides the element.\n\t * @param {!Element} item The list selected item.\n\t * @protected\n\t */\n\tonListItemSelected_(item) {\n\t\tvar selectedIndex = parseInt(item.getAttribute('data-index'), 10);\n\t\tthis.emit('select', this.getList().items[selectedIndex]);\n\t\tthis.visible = false;\n\t}\n\n\t/**\n\t * Synchronization logic for `visible` state.\n\t * @param {boolean} visible\n\t */\n\tsyncVisible(visible) {\n\t\tsuper.syncVisible(visible);\n\n\t\tif (visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Asserts that formatted data is valid. Throws error if item is not in the\n\t * valid syntax.\n\t * @param {*} item\n\t * @protected\n\t */\n\tassertItemObjectStructure_(item) {\n\t\tif (!core.isObject(item)) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object');\n\t\t}\n\t\tif (!item.hasOwnProperty('textPrimary')) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object with \\'textPrimary\\' key');\n\t\t}\n\t}\n}\nSoy.register(Autocomplete, templates);\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nAutocomplete.STATE = {\n\t/**\n\t * Function that converts a given item to the format that should be used by\n\t * the autocomplete.\n\t * @type {!function()}\n\t */\n\tformat: {\n\t\tvalue: function(item) {\n\t\t\tif (core.isString(item)) {\n\t\t\t\titem = {\n\t\t\t\t\ttextPrimary: item\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (core.isObject(item) && !item.text) {\n\t\t\t\titem.text = item.textPrimary;\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\t}\n};\n\nexport default Autocomplete;\nimport JQueryAdapter from 'metal-jquery-adapter/src/JQueryAdapter';JQueryAdapter.register('autocomplete', Autocomplete);"]}