{"version":3,"sources":["/source/globalEval.js"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;;;;;;;KAQM,U;;;;;aAQE,G,gBAAI,I,EAAM,Y,EAAc;AAC9B,OAAI,SAAS,SAAS,aAAT,CAAuB,QAAvB,CAAb;AACA,UAAO,IAAP,GAAc,IAAd;AACA,OAAI,YAAJ,EAAkB;AACjB,iBAAa,MAAb;AACA,IAFD,MAEO;AACN,aAAS,IAAT,CAAc,WAAd,CAA0B,MAA1B;AACA;AACD,iBAAI,YAAJ,CAAiB,MAAjB;AACA,UAAO,MAAP;AACA,G;;aAWM,O,oBAAQ,G,EAAK,Y,EAAc,Y,EAAc;AAC/C,OAAI,SAAS,SAAS,aAAT,CAAuB,QAAvB,CAAb;AACA,UAAO,GAAP,GAAa,GAAb;;AAEA,OAAI,WAAW,SAAX,QAAW,GAAW;AACzB,kBAAI,YAAJ,CAAiB,MAAjB;AACA,oBAAgB,cAAhB;AACA,IAHD;AAIA,iBAAI,IAAJ,CAAS,MAAT,EAAiB,MAAjB,EAAyB,QAAzB;AACA,iBAAI,IAAJ,CAAS,MAAT,EAAiB,OAAjB,EAA0B,QAA1B;;AAEA,OAAI,YAAJ,EAAkB;AACjB,iBAAa,MAAb;AACA,IAFD,MAEO;AACN,aAAS,IAAT,CAAc,WAAd,CAA0B,MAA1B;AACA;;AAED,UAAO,MAAP;AACA,G;;aAWM,S,sBAAU,M,EAAQ,Y,EAAc,Y,EAAc;AACpD,OAAI,WAAW,SAAX,QAAW,GAAW;AACzB,oBAAgB,cAAhB;AACA,IAFD;AAGA,OAAI,OAAO,IAAP,IAAe,OAAO,IAAP,KAAgB,iBAAnC,EAAsD;AACrD,iBAAM,QAAN,CAAe,QAAf;AACA;AACA;AACD,iBAAI,YAAJ,CAAiB,MAAjB;AACA,OAAI,OAAO,GAAX,EAAgB;AACf,WAAO,WAAW,OAAX,CAAmB,OAAO,GAA1B,EAA+B,YAA/B,EAA6C,YAA7C,CAAP;AACA,IAFD,MAEO;AACN,iBAAM,QAAN,CAAe,QAAf;AACA,WAAO,WAAW,GAAX,CAAe,OAAO,IAAtB,EAA4B,YAA5B,CAAP;AACA;AACD,G;;aAUM,mB,gCAAoB,O,EAAS,Y,EAAc,Y,EAAc;AAC/D,OAAI,UAAU,QAAQ,gBAAR,CAAyB,QAAzB,CAAd;AACA,OAAI,QAAQ,MAAZ,EAAoB;AACnB,eAAW,iBAAX,CAA6B,OAA7B,EAAsC,CAAtC,EAAyC,YAAzC,EAAuD,YAAvD;AACA,IAFD,MAEO,IAAI,YAAJ,EAAkB;AACxB,iBAAM,QAAN,CAAe,YAAf;AACA;AACD,G;;aAWM,iB,8BAAkB,O,EAAS,K,EAAO,Y,EAAc,Y,EAAc;AACpE,cAAW,SAAX,CAAqB,QAAQ,IAAR,CAAa,KAAb,CAArB,EAA0C,YAAW;AACpD,QAAI,QAAQ,QAAQ,MAAR,GAAiB,CAA7B,EAAgC;AAC/B,gBAAW,iBAAX,CAA6B,OAA7B,EAAsC,QAAQ,CAA9C,EAAiD,YAAjD,EAA+D,YAA/D;AACA,KAFD,MAEO,IAAI,YAAJ,EAAkB;AACxB,kBAAM,QAAN,CAAe,YAAf;AACA;AACD,IAND,EAMG,YANH;AAOA,G;;;;;mBAGa,U","sourcesContent":["'use strict';\n\nimport { async } from 'metal';\nimport dom from './dom';\n\n/**\n * Utility functions for running javascript code in the global scope.\n */\nclass globalEval {\n\t/**\n\t * Evaluates the given string in the global scope.\n\t * @param {string} text\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic run(text, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.text = text;\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\t\tdom.exitDocument(script);\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the given javascript file in the global scope.\n\t * @param {string} src The file's path.\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runFile(src, opt_callback, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.src = src;\n\n\t\tvar callback = function() {\n\t\t\tdom.exitDocument(script);\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tdom.once(script, 'load', callback);\n\t\tdom.once(script, 'error', callback);\n\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the code referenced by the given script element.\n\t * @param {!Element} script\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runScript(script, opt_callback, opt_appendFn) {\n\t\tvar callback = function() {\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tif (script.type && script.type !== 'text/javascript') {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn;\n\t\t}\n\t\tdom.exitDocument(script);\n\t\tif (script.src) {\n\t\t\treturn globalEval.runFile(script.src, opt_callback, opt_appendFn);\n\t\t} else {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn globalEval.run(script.text, opt_appendFn);\n\t\t}\n\t}\n\n\t/**\n\t * Evaluates any script tags present in the given element.\n\t * @params {!Element} element\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInElement(element, opt_callback, opt_appendFn) {\n\t\tvar scripts = element.querySelectorAll('script');\n\t\tif (scripts.length) {\n\t\t\tglobalEval.runScriptsInOrder(scripts, 0, opt_callback, opt_appendFn);\n\t\t} else if (opt_callback) {\n\t\t\tasync.nextTick(opt_callback);\n\t\t}\n\t}\n\n\t/**\n\t * Runs the given scripts elements in the order that they appear.\n\t * @param {!NodeList} scripts\n\t * @param {number} index\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInOrder(scripts, index, opt_callback, opt_appendFn) {\n\t\tglobalEval.runScript(scripts.item(index), function() {\n\t\t\tif (index < scripts.length - 1) {\n\t\t\t\tglobalEval.runScriptsInOrder(scripts, index + 1, opt_callback, opt_appendFn);\n\t\t\t} else if (opt_callback) {\n\t\t\t\tasync.nextTick(opt_callback);\n\t\t\t}\n\t\t}, opt_appendFn);\n\t}\n}\n\nexport default globalEval;\n"]}